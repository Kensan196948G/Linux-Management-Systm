Webmin風 Linux管理WebUIプロジェクトClaudeCode開発環境仕様書


# 📘 ClaudeCode 開発環境仕様書


概要
✅ **そのまま `CLAUDE.md / ENVIRONMENT.md` に落とせる**
✅ **SubAgent / Hooks / MCP / GitHub Actions が噛み合う**
✅ **無限自動修復ループ前提**

---

Webmin風 Linux管理WebUI 開発基盤

---

## 1. 文書概要

| 項目   | 内容                        |
| ---- | ------------------------- |
| 文書名  | ClaudeCode 開発環境仕様書        |
| 対象   | Linux管理WebUI（Webminライク）   |
| 開発方式 | ClaudeCode 主導 + 人間レビュー    |
| 前提   | Linuxネイティブ ClaudeCode     |
| 目的   | **安全・並列・自動修復が可能な開発基盤の確立** |

---

## 2. 全体アーキテクチャ（開発視点）

![Image](https://cdn.sanity.io/images/4zrzovbb/website/1198befc0b33726c45692ac40f764022f4de1bf2-4584x2579.png)

![Image](https://miro.medium.com/1%2AOYmkVffRgQ1bioPm0EhNOw.png)

![Image](https://www.dailydoseofds.com/content/images/2025/05/image-28.png)

```
┌──────────────┐
│  Human (Lead)│
└──────┬───────┘
       ↓ 承認
┌──────────────────────────┐
│ ClaudeCode (Linux Native) │
│  ├ SubAgents (7体)        │
│  ├ Skills                 │
│  ├ Hooks (並列)           │
│  ├ MCP Servers            │
│  └ Memory                 │
└──────┬───────────────────┘
       ↓ push
┌──────────────────────────┐
│ GitHub (Worktrees)        │
│ GitHub Actions            │
│  └ 自動エラー検知・修復   │
└──────────────────────────┘
```

---

## 3. SubAgent 設計（体数・役割）

### ✅ **推奨：7体構成（最小かつ強力）**

| # | SubAgent       | 主担当                   |
| - | -------------- | --------------------- |
| 1 | **@Planner**   | 要件分解・タスク設計            |
| 2 | **@Architect** | 全体設計・セキュリティ           |
| 3 | **@Backend**   | API / sudo / wrapper  |
| 4 | **@Frontend**  | WebUI                 |
| 5 | **@Security**  | 脅威分析・拒否基準             |
| 6 | **@QA**        | テスト設計                 |
| 7 | **@CIManager** | GitHub Actions / 修復制御 |

👉
**7体を超えると文脈同期コストが増える**
**7体未満だと職務分離（SoD）が崩れる**

---

## 4. Skills 設計（最小にして十分）

### 4.1 Build系 Skills

| Skill                  | 内容            |
| ---------------------- | ------------- |
| requirements-breakdown | 要件→タスク        |
| secure-architecture    | sudo / root設計 |
| api-design             | FastAPI設計     |
| wrapper-design         | sudoラッパー      |
| ui-layout              | WebUI構成       |
| logging-design         | 監査ログ          |
| doc-generator          | 文書生成          |

---

### 4.2 Runtime系 Skills

| Skill            | 内容      |
| ---------------- | ------- |
| static-review    | コード静的検査 |
| security-review  | 危険操作検知  |
| test-generator   | pytest  |
| failure-analysis | ログ解析    |
| auto-refactor    | 最小修正    |
| drift-detection  | 仕様逸脱検知  |

---

## 5. Hooks 設計（並列実行の核）

### 5.1 有効化 Hooks（必須）

| Hook         | 動作           |
| ------------ | ------------ |
| pre-task     | 仕様・拒否基準読み込み  |
| on-plan      | SubAgent並列起動 |
| on-change    | 差分検査         |
| post-change  | セキュリティ再検証    |
| pre-push     | CI想定チェック     |
| post-failure | 修復ループ起動      |
| auto-summary | Memory記録     |

---

### 5.2 並列実行ポリシー

* Architect / Security / QA は **常時並列**
* Backend / Frontend は **競合時ロック**
* CIManager は **常駐**

---

## 6. GitHub Actions 設計（無限自動修復）

### 6.1 基本方針

| 項目     | 設定          |
| ------ | ----------- |
| 有効化    | ✅           |
| Runner | Self-hosted |
| 実行間隔   | **5分間隔**    |
| 修復回数   | 無限（状態管理あり）  |
| ループ防止  | 同一エラー検知     |

---

### 6.2 自動修復ループ（概念）

```
Build/Test
  ↓ 실패
ログ解析
  ↓
Claude CLI 修復
  ↓
Commit & Push
  ↓
再実行（5分後）
```

### 6.3 Worktrees 利用

* main：安定
* repair/*：修復用
* feature/*：実装用

👉 **修復は main を直接触らない**

---

## 7. MCP 有効化仕様（指定8種）

### 7.1 MCP一覧と役割

| MCP                     | 役割           |
| ----------------------- | ------------ |
| **brave-search**        | 技術調査         |
| **ChromeDevTools**      | WebUI検証      |
| **context7**            | 長文文脈保持       |
| **github**              | PR / Issue操作 |
| **memory**              | 永続記憶         |
| **playwright**          | E2Eテスト       |
| **Memory Keeper MCP**   | 仕様固定         |
| **sequential-thinking** | 設計思考整理       |

---

### 7.2 MCP 利用原則

* brave-search：設計初期のみ
* playwright：CI連動
* memory / keeper：**常時**
* sequential-thinking：要件・設計時

---

## 8. メモリ戦略（事故防止）

### 8.1 永続化対象

* 要件定義
* 拒否基準
* sudo制御ルール
* 修復履歴
* 承認判断

### 8.2 禁止事項

* root権限拡張を記憶しない
* 一時的回避策を正解として保存しない

---

## 9. セキュリティ開発原則（ClaudeCode向け）

* **Allowlist First**
* **Deny by Default**
* **Shellを信じない**
* **UI入力は信用しない**
* **ログは裏切らない**

---

## 10. 初期 ClaudeCode 起動プロンプト（雛形）

```
あなたはLinux管理WebUIを開発するClaudeCodeです。
本プロジェクトはroot操作を最小化し、
sudo allowlist と監査証跡を最優先します。

SubAgent 7体構成を有効化し、
Security / Architect / QA を常時並列実行してください。

仕様逸脱、危険操作、sudo拡張は
必ず停止・警告・人間承認を要求してください。
```

---

## 11. 本仕様の位置づけ

> この開発環境は
> **「速く作るため」ではなく**
> **「壊れず、暴走せず、説明できるため」**
> に設計されている。


